{"ast":null,"code":"\"use strict\";\n\nvar _defineProperty = require(\"/home/rami/BHARA/BahraPro/BahraPro/node_modules/@babel/runtime/helpers/defineProperty\");\n\nvar _reactJsxRuntime = require(\"react/jsx-runtime\");\n\nvar _regeneratorRuntime = require(\"/home/rami/BHARA/BahraPro/BahraPro/node_modules/@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"/home/rami/BHARA/BahraPro/BahraPro/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar _slicedToArray = require(\"/home/rami/BHARA/BahraPro/BahraPro/node_modules/@babel/runtime/helpers/slicedToArray\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function get() {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  }\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar react_1 = __importStar(require(\"react\"));\n\nvar auth_functions_1 = require(\"../../src/utilty/auth-functions\");\n\nvar spinner_1 = __importDefault(require(\"../../src/styles/spinner/spinner\"));\n\nvar context_1 = require(\"../../src/utilty/context\");\n\nvar cookie_1 = __importDefault(require(\"cookie\"));\n\nvar parseCookies_1 = __importDefault(require(\"../../src/utilty/parseCookies\"));\n\nvar utilty_1 = require(\"../../src/utilty\");\n\nvar bahraProviders_1 = __importDefault(require(\"./bahraProviders\"));\n\nvar index_1 = require(\"../../src/styles/theme/index\");\n\nvar AuthProvider = function AuthProvider(props) {\n  var initialLoginState = {\n    isLoading: true,\n    userID: null,\n    token: null,\n    RefreshToken: null,\n    user: props.user\n  }; // const client = useApolloClient()\n\n  var loginReducer = function loginReducer(prevState, action) {\n    switch (action.type) {\n      case 'USER':\n        return Object.assign(Object.assign({}, prevState), {\n          user: action.setUser,\n          isLoading: false\n        });\n\n      case 'RETRIEVE_TOKEN':\n        return Object.assign(Object.assign({}, prevState), {\n          token: action.token,\n          RefreshToken: action.RefreshToken,\n          userID: action.userID,\n          isLoading: false\n        });\n\n      case 'LOGIN':\n        return Object.assign(Object.assign({}, prevState), {\n          userID: action.userID,\n          token: action.token,\n          RefreshToken: action.RefreshToken,\n          isLoading: false\n        });\n\n      case 'LOGOUT':\n        return Object.assign(Object.assign({}, prevState), {\n          userID: null,\n          authToken: null,\n          RefreshToken: null,\n          isLoading: false\n        });\n\n      case 'REGISTER':\n        return Object.assign(Object.assign({}, prevState), {\n          userID: action.userID,\n          token: action.jwtAuthToken,\n          RefreshToken: action.RefreshToken,\n          isLoading: false\n        });\n    }\n  };\n\n  var _react_1$default$useR = react_1[\"default\"].useReducer(loginReducer, initialLoginState),\n      _react_1$default$useR2 = _slicedToArray(_react_1$default$useR, 2),\n      loginState = _react_1$default$useR2[0],\n      dispatch = _react_1$default$useR2[1];\n\n  var _react_1$useState = react_1.useState(props.user),\n      _react_1$useState2 = _slicedToArray(_react_1$useState, 2),\n      user = _react_1$useState2[0],\n      setUser = _react_1$useState2[1];\n\n  var authContext = react_1[\"default\"].useMemo(function () {\n    return {\n      user: user,\n      // setUser: async ( userID:string) => {\n      //     if (!isEmpty(userID)) {\n      //         async (userID)=>{\n      //                 await props.apolloClient.query({ query:WP_USER,\n      //                   variables:{id:userID},\n      //                 }).then( async(data) => {\n      //                   console.log('ddddddddddddddddddddddddddddd',data)\n      //                   const wpUser = data.user;\n      //                   console.log('wpUser', wpUser);\n      //                   setUser({user:wpUser})\n      //                   return wpUser\n      //                 }).catch((err)=>console.error(err)\n      //                 )\n      //         }\n      //     }\n      //     dispatch({ type: 'USER', user: user });\n      // },\n      logIn: function () {\n        var _logIn = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(user) {\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  if (auth_functions_1.isEmpty(user)) {\n                    _context.next = 20;\n                    break;\n                  }\n\n                  _context.prev = 1;\n                  _context.next = 4;\n                  return setUser;\n\n                case 4:\n                  setUser(user);\n                  document.cookie = cookie_1[\"default\"].serialize('authToken', user.jwtAuthToken, {\n                    maxAge: 30 * 24 * 60 * 60\n                  });\n                  document.cookie = cookie_1[\"default\"].serialize('refreshToken', user.jwtRefreshToken, {\n                    maxAge: 30 * 24 * 60 * 60\n                  });\n                  document.cookie = cookie_1[\"default\"].serialize('userID', user.id, {\n                    maxAge: 30 * 24 * 60 * 60\n                  });\n                  document.cookie = cookie_1[\"default\"].serialize('username', user.username, {\n                    maxAge: 30 * 24 * 60 * 60\n                  });\n                  _context.next = 11;\n                  return localStorage.setItem('authToken', user.jwtAuthToken);\n\n                case 11:\n                  _context.next = 13;\n                  return localStorage.setItem('refreshToken', user.jwtRefreshToken);\n\n                case 13:\n                  _context.next = 15;\n                  return localStorage.setItem('userID', user.id);\n\n                case 15:\n                  _context.next = 20;\n                  break;\n\n                case 17:\n                  _context.prev = 17;\n                  _context.t0 = _context[\"catch\"](1);\n                  console.log(_context.t0);\n\n                case 20:\n                  dispatch({\n                    type: 'LOGIN',\n                    userID: user.id,\n                    token: user.jwtAuthToken\n                  });\n\n                case 21:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee, null, [[1, 17]]);\n        }));\n\n        function logIn(_x) {\n          return _logIn.apply(this, arguments);\n        }\n\n        return logIn;\n      }(),\n      logOut: function () {\n        var _logOut = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  _context2.prev = 0;\n                  _context2.next = 3;\n                  return localStorage.removeItem('authToken');\n\n                case 3:\n                  _context2.next = 5;\n                  return localStorage.removeItem('refreshToken');\n\n                case 5:\n                  _context2.next = 7;\n                  return localStorage.removeItem('userID');\n\n                case 7:\n                  _context2.next = 12;\n                  break;\n\n                case 9:\n                  _context2.prev = 9;\n                  _context2.t0 = _context2[\"catch\"](0);\n                  console.log(_context2.t0);\n\n                case 12:\n                  dispatch({\n                    type: 'LOGOUT'\n                  });\n\n                case 13:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2, null, [[0, 9]]);\n        }));\n\n        function logOut() {\n          return _logOut.apply(this, arguments);\n        }\n\n        return logOut;\n      }(),\n      signUp: function () {\n        var _signUp = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(user) {\n          return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n            while (1) {\n              switch (_context3.prev = _context3.next) {\n                case 0:\n                  if (auth_functions_1.isEmpty(user)) {\n                    _context3.next = 14;\n                    break;\n                  }\n\n                  _context3.prev = 1;\n                  setUser(user);\n                  _context3.next = 5;\n                  return localStorage.setItem('authToken', user.jwtAuthToken);\n\n                case 5:\n                  _context3.next = 7;\n                  return localStorage.setItem('refreshToken', user.jwtRefreshToken);\n\n                case 7:\n                  _context3.next = 9;\n                  return localStorage.setItem('userID', user.id);\n\n                case 9:\n                  _context3.next = 14;\n                  break;\n\n                case 11:\n                  _context3.prev = 11;\n                  _context3.t0 = _context3[\"catch\"](1);\n                  console.log(_context3.t0);\n\n                case 14:\n                  // console.log('user token: ', authToken);\n                  dispatch({\n                    type: 'LOGIN',\n                    id: user.id,\n                    token: user.jwtAuthToken\n                  });\n\n                case 15:\n                case \"end\":\n                  return _context3.stop();\n              }\n            }\n          }, _callee3, null, [[1, 11]]);\n        }));\n\n        function signUp(_x2) {\n          return _signUp.apply(this, arguments);\n        }\n\n        return signUp;\n      }()\n    };\n  }, []);\n\n  if (!auth_functions_1.isEmpty(props.user)) {} else {\n    react_1.useEffect(function () {\n      setTimeout( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        var authToken, userID, RToken;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                authToken = null;\n                userID = null;\n                RToken = null;\n                _context4.prev = 3;\n\n                if (!utilty_1.isServer) {\n                  _context4.next = 8;\n                  break;\n                }\n\n                _context4.t0 = parseCookies_1[\"default\"]().authToken;\n                _context4.next = 11;\n                break;\n\n              case 8:\n                _context4.next = 10;\n                return localStorage.getItem('authToken');\n\n              case 10:\n                _context4.t0 = _context4.sent;\n\n              case 11:\n                authToken = _context4.t0;\n                _context4.next = 14;\n                return localStorage.getItem('refreshToken');\n\n              case 14:\n                RToken = _context4.sent;\n\n                if (!utilty_1.isServer) {\n                  _context4.next = 19;\n                  break;\n                }\n\n                _context4.t1 = parseCookies_1[\"default\"]().userID;\n                _context4.next = 22;\n                break;\n\n              case 19:\n                _context4.next = 21;\n                return localStorage.getItem('userID');\n\n              case 21:\n                _context4.t1 = _context4.sent;\n\n              case 22:\n                userID = _context4.t1;\n                _context4.next = 28;\n                break;\n\n              case 25:\n                _context4.prev = 25;\n                _context4.t2 = _context4[\"catch\"](3);\n                console.log(_context4.t2);\n\n              case 28:\n                console.log(authToken);\n                dispatch({\n                  type: 'RETRIEVE_TOKEN',\n                  userID: userID,\n                  RefreshToken: RToken,\n                  token: authToken\n                });\n\n              case 30:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, null, [[3, 25]]);\n      })), 1000);\n    }, []);\n  }\n\n  if (loginState.isLoading) {\n    return /*#__PURE__*/_reactJsxRuntime.jsx(\"div\", {\n      style: {\n        flex: 1,\n        justifyContent: 'center',\n        alignItems: 'center'\n      },\n      children: /*#__PURE__*/_reactJsxRuntime.jsx(spinner_1[\"default\"], {})\n    });\n  }\n\n  var Component = props.Component;\n  var pageProps = props.pageProps;\n  return /*#__PURE__*/_reactJsxRuntime.jsx(context_1.AuthContext.Provider, {\n    value: authContext,\n    children: /*#__PURE__*/_reactJsxRuntime.jsxs(bahraProviders_1[\"default\"], _objectSpread(_objectSpread({}, props.children), {}, {\n      children: [/*#__PURE__*/_reactJsxRuntime.jsx(index_1.GlobalStyle, {}), loginState.token && loginState.userID !== null ? /*#__PURE__*/_reactJsxRuntime.jsx(Component, _objectSpread(_objectSpread({}, pageProps), {}, {\n        user: props.user\n      })) : /*#__PURE__*/_reactJsxRuntime.jsx(Component, _objectSpread({}, pageProps))]\n    }))\n  });\n};\n\nexports[\"default\"] = AuthProvider;","map":null,"metadata":{},"sourceType":"script"}